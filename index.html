<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personalized Transformation Plan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        /* THEMES */
        body.theme-sunny { background-color: #fefce8; } 
        body.theme-indigo { background-color: #f5f3ff; } 
        body.theme-midnight { background-color: #111827; color: #f9fafb; } 

        .nav-btn {
            @apply px-3 py-2 rounded-md text-sm font-medium text-gray-600 hover:opacity-80 transition-all duration-150 border-b-2 border-transparent;
        }
        .theme-midnight .nav-btn { @apply text-gray-300; }
        
        .nav-btn.active {
            @apply bg-white text-indigo-600 font-semibold border-b-2 border-indigo-600 shadow-sm;
        }
        .theme-midnight .nav-btn.active {
            @apply bg-gray-800 text-indigo-400 border-indigo-500;
        }

        .page-section { display: none; }
        .page-section.active { display: block; }

        .card {
            @apply bg-white shadow-lg rounded-xl p-8 md:p-10 overflow-hidden border border-gray-100 transition-all duration-300;
        }
        .theme-midnight .card {
            @apply bg-gray-800 border-gray-700 shadow-2xl;
        }
        
        .day-btn {
            @apply px-4 py-2 rounded-md text-sm font-medium text-gray-500 bg-gray-50 shadow-sm border border-yellow-200 hover:bg-white hover:text-gray-900 transition-all duration-200 flex-1 opacity-50;
        }
        .theme-midnight .day-btn { @apply bg-gray-700 border-gray-600 text-gray-300; }
        
        .day-btn.active {
            @apply bg-indigo-600 text-white shadow-lg ring-2 ring-indigo-400 ring-offset-1 opacity-100 transform scale-105;
        }
        
        .choice-btn {
            @apply w-full text-left p-4 border border-gray-300 rounded-lg hover:bg-indigo-50 cursor-pointer transition-colors duration-150 text-sm;
        }
        .theme-midnight .choice-btn { @apply border-gray-600 hover:bg-gray-700; }
        
        .choice-btn.active {
            @apply bg-indigo-600 border-indigo-700 ring-2 ring-indigo-300 text-white font-bold shadow-md;
        }
        .choice-btn.active span, .choice-btn.active p { @apply text-white; }

        .input-field {
            @apply w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-300 focus:border-indigo-500 transition-colors duration-150 bg-white text-gray-900;
        }
        .theme-midnight .input-field {
            @apply bg-gray-700 border-gray-600 text-white;
        }

        .btn-primary {
            @apply w-full bg-indigo-600 text-white px-6 py-3 rounded-lg font-medium shadow-md hover:shadow-lg hover:bg-indigo-700 transition-all duration-150;
        }
        .btn-danger {
            @apply w-full bg-red-600 text-white px-6 py-3 rounded-lg font-medium shadow-md hover:shadow-lg hover:bg-red-700 transition-all duration-150;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px; 
            max-width: 400px; 
            margin: 0 auto; 
        }
        .calendar-day {
            @apply w-10 h-10 flex items-center justify-center text-sm font-medium rounded-full bg-gray-100 text-gray-500;
        }
        .theme-midnight .calendar-day { @apply bg-gray-700 text-gray-400; }
        .calendar-day.completed { @apply bg-green-500 text-white font-bold; }
        .calendar-day.today { @apply ring-2 ring-indigo-500 ring-offset-2; }
        
        /* EXERCISE ITEM STYLING */
        .exercise-item {
            @apply flex justify-between border-b border-gray-50 py-3 transition-opacity duration-300;
        }
        .remove-ex {
            @apply opacity-0 group-hover:opacity-100 text-[10px] uppercase font-bold text-red-400 hover:text-red-600 cursor-pointer transition-all ml-2;
        }
    </style>
</head>
<body class="theme-sunny">

    <div id="setup-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="text-3xl font-extrabold text-gray-900 mb-4 text-center">Athlete Profile</h2>
            <p class="text-lg text-gray-600 mb-6 text-center">Customize your goal and training style to generate your precision blueprint.</p>
            <button id="go-to-profile-btn-modal" class="btn-primary">Configure Engine</button>
        </div>
    </div>

    <header class="sticky top-0 bg-white shadow-sm z-10"> 
        <nav class="container mx-auto px-4 py-3 flex justify-center space-x-1 md:space-x-2">
            <button class="nav-btn active" data-target="dashboard-page">Dashboard</button>
            <button class="nav-btn" data-target="tracker-page">Tracker</button>
            <button class="nav-btn" data-target="diet-page">Diet</button>
            <button class="nav-btn" data-target="workout-page">Workouts</button>
            <button class="nav-btn" data-target="goals-page">Health</button>
            <button class="nav-btn" data-target="profile-page">Settings</button>
        </nav>
    </header>

    <main class="container mx-auto p-6 md:p-12">

        <!-- DASHBOARD -->
        <section class="page-section active" id="dashboard-page">
            <div class="mb-10"> 
                <h1 id="dashboard-title" class="text-3xl font-extrabold mb-2 text-indigo-700">Get Moving!</h1>
                <p class="text-lg opacity-80">Execution for <span id="current-date-display" class="font-bold">...</span></p>
            </div>

            <div class="mb-10 flex flex-wrap gap-2">
                <button class="day-btn" data-day="sun">Sun</button>
                <button class="day-btn" data-day="mon">Mon</button>
                <button class="day-btn" data-day="tue">Tue</button>
                <button class="day-btn" data-day="wed">Wed</button>
                <button class="day-btn" data-day="thu">Thu</button>
                <button class="day-btn" data-day="fri">Fri</button>
                <button class="day-btn" data-day="sat">Sat</button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                <div class="flex flex-col gap-10"> 
                    <div class="card" id="dashboard-workout-card">
                        <div class="flex justify-between items-start">
                            <h2 id="dashboard-workout-title" class="text-xl font-bold text-indigo-600 mb-2">Workout</h2>
                            <span id="level-badge" class="px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-[10px] font-black uppercase">Level</span>
                        </div>
                        <p id="dashboard-workout-subtitle" class="text-sm opacity-60 mb-6">Select a day to begin.</p>
                        <div id="dashboard-workout" class="space-y-1"></div>
                        <div id="workout-complete-container" class="mt-6"></div>
                    </div>

                    <div class="card">
                        <h2 class="text-xl font-bold text-indigo-600 mb-6 text-center">Vitals</h2>
                        <div class="grid grid-cols-2 gap-6">
                            <div class="text-center">
                                <span id="water-count" class="text-4xl font-bold text-indigo-600">0</span>
                                <p class="text-[10px] uppercase tracking-tighter opacity-50">Water</p>
                                <p class="text-xs font-bold text-indigo-400 mt-1">Goal: <span id="water-goal-display">16</span></p>
                                <div class="flex justify-center gap-2 mt-2">
                                    <button id="water-minus-btn" class="bg-gray-100 p-1 rounded-lg w-8 h-8">-</button>
                                    <button id="water-plus-btn" class="bg-indigo-600 text-white p-1 rounded-lg w-8 h-8">+</button>
                                </div>
                            </div>
                            <div class="text-center border-l border-gray-100">
                                <span id="step-count-display" class="text-4xl font-bold text-green-600">0</span>
                                <p class="text-[10px] uppercase tracking-tighter opacity-50">Steps</p>
                                <p class="text-xs font-bold" id="step-goal-display">/ 10k</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card" id="dashboard-schedule-card">
                    <h2 id="dashboard-schedule-title" class="text-xl font-bold text-indigo-600 mb-6">Daily Routine</h2>
                    <div id="dashboard-schedule" class="max-h-[600px] overflow-y-auto pr-2 space-y-4"></div>
                </div>
            </div>
        </section>

        <!-- TRACKER -->
        <section class="page-section" id="tracker-page">
            <h1 class="text-3xl font-extrabold mb-10">Data Logging</h1>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-10"> 
                <div class="card">
                    <h2 class="text-xl font-bold text-indigo-600 mb-6">Log Weight</h2>
                    <div class="flex space-x-2 mb-8">
                        <input type="number" id="weight-input" step="0.1" class="input-field flex-1" placeholder="Weight">
                        <span id="weight-unit-label" class="flex items-center px-2 opacity-50 font-bold">kg</span>
                        <button id="log-weight-btn" class="btn-primary w-auto">Sync</button>
                    </div>
                    <div class="max-h-64 overflow-y-auto rounded-lg border border-gray-100">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Weight</th>
                                </tr>
                            </thead>
                            <tbody id="weight-history-table" class="bg-white divide-y divide-gray-100"></tbody>
                        </table>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="text-xl font-bold text-indigo-600 mb-6">Continuity</h2>
                    <div class="calendar-grid" id="consistency-calendar"></div>
                </div>
            </div>
        </section>

        <!-- DIET -->
        <section class="page-section" id="diet-page">
            <h1 id="diet-plan-title" class="text-3xl font-extrabold mb-2">Nutritional Engine</h1>
            <p id="diet-plan-description" class="text-lg opacity-80 mb-10 text-center"></p>
            <div id="diet-plan-options-container" class="grid grid-cols-1 md:grid-cols-2 gap-10"></div>
        </section>

        <!-- WORKOUTS -->
        <section class="page-section" id="workout-page">
            <h1 class="text-3xl font-extrabold mb-10 text-indigo-700">Training Architecture</h1>
            <div id="guidance-card" class="card mb-10 bg-indigo-50 border-indigo-200 hidden">
                <h2 id="guidance-title" class="text-xl font-bold text-indigo-700 mb-2"></h2>
                <p id="guidance-content" class="text-indigo-800 text-sm italic"></p>
            </div>
            <div class="card">
                <h2 class="text-2xl font-bold text-indigo-600 mb-8" id="workout-plan-title">Master Plan</h2>
                <div class="space-y-10" id="workout-plan-container"></div>
            </div>
        </section>

        <!-- HEALTH -->
        <section class="page-section" id="goals-page">
            <h1 class="text-3xl font-extrabold mb-10 text-indigo-700 text-center">Health Analysis</h1>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-10"> 
                <div class="card">
                    <h2 class="text-xl font-bold text-indigo-600 mb-6">Weight Trend</h2>
                    <div class="chart-container">
                        <canvas id="goal-chart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <h2 class="text-xl font-bold text-indigo-600 mb-6">Vital Metrics</h2>
                    <div class="space-y-6">
                        <div class="p-4 bg-gray-50 rounded-xl">
                            <span id="bmi-display" class="text-2xl font-bold block">BMI: --</span>
                            <span id="bmi-category" class="text-sm opacity-60">Category: --</span>
                        </div>
                        <div class="p-4 bg-gray-50 rounded-xl">
                            <span id="bmr-display" class="text-2xl font-bold block">BMR: --</span>
                            <span class="text-sm opacity-60">Basal Metabolic Rate</span>
                        </div>
                        <div class="p-4 bg-indigo-600 text-white rounded-xl shadow-lg">
                            <span id="tdee-display" class="text-2xl font-bold block">Daily Target: --</span>
                            <span class="text-sm opacity-80">Calorie Target with Deficit</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SETTINGS -->
        <section class="page-section" id="profile-page">
            <h1 class="text-3xl font-extrabold mb-10">System Settings</h1>
            <div class="card max-w-5xl mx-auto space-y-12">
                
                <!-- TOP SETTINGS -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div>
                        <label class="block text-xs font-bold uppercase tracking-widest opacity-40 mb-2">Display Name</label>
                        <input type="text" id="profile-name" class="input-field" placeholder="Athlete Name">
                    </div>
                    <div>
                        <label class="block text-xs font-bold uppercase tracking-widest opacity-40 mb-2">System Units</label>
                        <div class="flex gap-2" id="unit-choices">
                            <button class="choice-btn flex-1 text-center" data-unit="metric">Metric</button>
                            <button class="choice-btn flex-1 text-center" data-unit="imperial">Imperial</button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-bold uppercase tracking-widest opacity-40 mb-2">App Theme</label>
                        <div class="flex gap-2" id="theme-choices">
                            <button class="choice-btn flex-1 text-center" data-theme="theme-sunny">Sunny</button>
                            <button class="choice-btn flex-1 text-center" data-theme="theme-indigo">Indigo</button>
                            <button class="choice-btn flex-1 text-center" data-theme="theme-midnight">Dark</button>
                        </div>
                    </div>
                </div>

                <!-- LEVELS & RETURNING -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <label class="block text-xs font-bold uppercase tracking-widest opacity-40 mb-4">Training Level</label>
                        <div class="grid grid-cols-3 gap-2" id="level-choices">
                            <button class="choice-btn text-center" data-level="beginner">Beginner</button>
                            <button class="choice-btn text-center" data-level="intermediate">Inter</button>
                            <button class="choice-btn text-center" data-level="pro">Pro</button>
                        </div>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-200">
                        <label class="block text-xs font-bold uppercase tracking-widest text-yellow-800 mb-3">Returning from a break?</label>
                        <div class="flex gap-2" id="returning-choices">
                            <button class="choice-btn bg-white flex-1 text-center" data-returning="yes">Yes</button>
                            <button class="choice-btn bg-white flex-1 text-center" data-returning="no">No</button>
                        </div>
                    </div>
                </div>

                <!-- OBJECTIVES -->
                <div>
                    <label class="block text-xs font-bold uppercase tracking-widest opacity-40 mb-4">Core Objective</label>
                    <div class="grid grid-cols-2 md:grid-cols-5 gap-2" id="goal-choices">
                        <button class="choice-btn text-center" data-goal="fatLoss">Fat Loss</button>
                        <button class="choice-btn text-center" data-goal="muscle">Muscle</button>
                        <button class="choice-btn text-center" data-goal="endurance">Endurance</button>
                        <button class="choice-btn text-center" data-goal="mobility">Flexibility</button>
                        <button class="choice-btn text-center" data-goal="recomp">Recomp</button>
                    </div>
                </div>

                <!-- STYLE -->
                <div>
                    <label class="block text-xs font-bold uppercase tracking-widest opacity-40 mb-4">Training Style</label>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-2" id="style-choices">
                        <button class="choice-btn text-center" data-style="heavy">Heavy Compound</button>
                        <button class="choice-btn text-center" data-style="toning">High Rep / Toning</button>
                        <button class="choice-btn text-center" data-style="functional">Functional Focus</button>
                    </div>
                </div>

                <!-- BIOMETRICS -->
                <div class="grid grid-cols-1 sm:grid-cols-4 gap-6">
                    <div>
                        <label class="block text-sm opacity-60 mb-1">Age</label>
                        <input type="number" id="profile-age" class="input-field">
                    </div>
                    <div>
                        <label id="height-label" class="block text-sm opacity-60 mb-1">Height (cm)</label>
                        <input type="number" id="profile-height" class="input-field">
                    </div>
                    <div>
                        <label id="weight-label" class="block text-sm opacity-60 mb-1">Start (kg)</label>
                        <input type="number" id="profile-start-weight" step="0.1" class="input-field">
                    </div>
                    <div>
                        <label id="goal-weight-label" class="block text-sm opacity-60 mb-1">Goal (kg)</label>
                        <input type="number" id="profile-goal-weight" step="0.1" class="input-field">
                    </div>
                </div>

                <!-- GEAR & DEFICIT -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                    <div>
                        <label class="block text-xs font-bold uppercase tracking-widest opacity-40 mb-4">Gear available</label>
                        <div class="grid grid-cols-2 gap-2" id="equipment-choices">
                            <button class="choice-btn" data-equipment="gym">Full Gym</button>
                            <button class="choice-btn" data-equipment="home">Home (DB Only)</button>
                            <button class="choice-btn" data-equipment="body">Bodyweight</button>
                            <button class="choice-btn" data-equipment="bands">Bands Only</button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-bold uppercase tracking-widest opacity-40 mb-4">Target Deficit</label>
                        <div class="grid grid-cols-3 gap-2" id="deficit-choices">
                            <button class="choice-btn text-center" data-deficit="15">15%</button>
                            <button class="choice-btn text-center" data-deficit="20">20%</button>
                            <button class="choice-btn text-center" data-deficit="25">25%</button>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 pt-10">
                    <div>
                        <label class="block text-xs font-bold uppercase tracking-widest opacity-40 mb-2">Gender</label>
                        <div class="flex gap-2" id="gender-choices">
                            <button class="choice-btn flex-1 text-center" data-gender="male">M</button>
                            <button class="choice-btn flex-1 text-center" data-gender="female">F</button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-bold uppercase tracking-widest opacity-40 mb-2">Diet Baseline</label>
                        <div class="flex gap-2" id="diet-choices">
                            <button class="choice-btn flex-1 text-center" data-diet="veg">Veg</button>
                            <button class="choice-btn flex-1 text-center" data-diet="nonVeg">Non-Veg</button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-bold uppercase tracking-widest opacity-40 mb-2">Split Preference</label>
                        <div class="flex gap-2" id="frequency-choices">
                            <button class="choice-btn flex-1 text-center" data-frequency="3day">3/W</button>
                            <button class="choice-btn flex-1 text-center" data-frequency="4day">4/W</button>
                            <button class="choice-btn flex-1 text-center" data-frequency="5day">5/W</button>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <label class="block text-xs font-bold uppercase tracking-widest opacity-40 mb-2">Workout Start</label>
                        <select id="profile-workout-time" class="input-field"></select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold uppercase tracking-widest opacity-40 mb-2">Activity Multiplier</label>
                        <div class="grid grid-cols-2 gap-2" id="activity-choices">
                            <button class="choice-btn text-center" data-activity="1.2">Low</button>
                            <button class="choice-btn text-center" data-activity="1.55">Mod</button>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div>
                        <label class="block text-xs font-bold uppercase tracking-widest opacity-40 mb-2">Weeks</label>
                        <input type="number" id="profile-duration" class="input-field" value="8">
                    </div>
                    <div>
                        <label class="block text-xs font-bold uppercase tracking-widest opacity-40 mb-2">Step Goal</label>
                        <input type="number" id="step-goal-input" class="input-field" value="10000">
                    </div>
                    <div>
                        <label class="block text-xs font-bold uppercase tracking-widest opacity-40 mb-2">Water Goal</label>
                        <input type="number" id="water-goal-input" class="input-field" value="16">
                    </div>
                </div>

                <div class="pt-10 flex flex-col sm:flex-row gap-4 border-t border-gray-100">
                    <button id="save-profile-btn" class="btn-primary">Sync All Engine Parameters</button>
                    <button id="reset-app-btn" class="btn-danger opacity-50 hover:opacity-100">Wipe Data</button>
                </div>
            </div>
        </section>

    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const workoutMatrix = {
                'gym': { 
                    'fatLoss': { '3day': [
                        { key: 'mon', title: 'Power Circuit', exercises: ['Barbell Squat: 3x10', 'Bench Press: 3x10', 'Lat Pulldowns: 3x12', 'Plank: 3x60s'] },
                        { key: 'wed', title: 'Metabolic Hinge', exercises: ['Deadlifts: 3x8', 'Overhead Press: 3x10', 'Cable Rows: 3x12', 'Bicep Curls: 3x12'] },
                        { key: 'fri', title: 'Hypertrophy Burn', exercises: ['Leg Press: 3x15', 'Incline DB Press: 3x12', 'Lateral Raises: 3x15', 'Facepulls: 3x15'] }
                    ]},
                    'muscle': { '3day': [
                        { key: 'mon', title: 'Push Focus', exercises: ['Barbell Squat: 4x8', 'Bench Press: 4x10', 'Tricep Ext: 3x12'] },
                        { key: 'wed', title: 'Pull Focus', exercises: ['Deadlifts: 3x5', 'Pullups: 3xMax', 'Barbell Row: 3x10'] },
                        { key: 'fri', title: 'Isolation/Legs', exercises: ['Leg Press: 4x12', 'DB Flys: 3x12', 'Lateral Raise: 3x15'] }
                    ]},
                    'endurance': { '3day': [
                        { key: 'mon', title: 'Cardio Engine', exercises: ['Box Jumps: 3x15', 'Kettlebell Swings: 3x20', 'Rows: 3x15', 'Shadow Boxing: 10m'] },
                        { key: 'wed', title: 'Stamina Build', exercises: ['Burpees: 3x12', 'Thrusters: 3x15', 'Plank: 3x90s', 'Mountain Climbers: 3x45s'] },
                        { key: 'fri', title: 'Pace Work', exercises: ['Walking Lunges: 3x20', 'Pushups: 3xMax', 'Bear Crawls: 3x20m', 'Step-ups: 3x15'] }
                    ]},
                    'mobility': { '3day': [
                        { key: 'mon', title: 'Lower Flow', exercises: ['90-90 Hips: 3x10', 'Cossack Squat: 3x12', 'Deep Squat Hold: 3x60s'] },
                        { key: 'wed', title: 'Spine/Upper', exercises: ['Cat Cow: 3x15', 'Thoracic Rotation: 3x10', 'Plank to Pike: 3x12'] },
                        { key: 'fri', title: 'Full Chain', exercises: ['Sun Salutation: 5 reps', 'Worlds Greatest Stretch: 3x8', 'Downward Dog: 3x60s'] }
                    ]},
                    'recomp': { '3day': [
                        { key: 'mon', title: 'Hybrid Split A', exercises: ['Barbell Squat: 3x10', 'Bench Press: 3x10', 'DB Row: 3x12'] },
                        { key: 'wed', title: 'Hybrid Split B', exercises: ['Deadlifts: 3x8', 'Overhead Press: 3x10', 'Chinups: 3xMax'] },
                        { key: 'fri', title: 'Hybrid Split C', exercises: ['Leg Press: 3x12', 'DB Incline: 3x12', 'Plank: 3x60s'] }
                    ]}
                },
                'home': { 
                    'fatLoss': { '3day': [
                        { key: 'mon', title: 'DB Power', exercises: ['DB Squat: 3x15', 'DB Floor Press: 3x12', 'DB Row: 3x12', 'Lying Leg Raise: 3x15'] },
                        { key: 'wed', title: 'Functional Strength', exercises: ['DB RDL: 3x12', 'DB Arnold Press: 3x12', 'DB Hammer Curls: 3x12', 'Lunges: 3x10 per leg'] },
                        { key: 'fri', title: 'Hypertrophy Burn', exercises: ['DB Thrusters: 3x12', 'Pushups: 3xMax', 'Plank: 3x60s'] }
                    ]}
                }
            };

            const heavySwaps = {
                'Barbell Squat': 'DB Goblet Squat',
                'Bench Press': 'DB Press or Pushups',
                'Deadlifts': 'DB Romanian Deadlift',
                'Deadlift': 'DB Romanian Deadlift',
                'Overhead Press': 'Arnold Press',
                'Barbell Row': 'DB Single Arm Row',
                'Leg Press': 'Walking Lunges'
            };

            const primerCircuit = [
                { key: 'mon', title: 'Primer Cycle A', exercises: ['Goblet Squats: 2x15', 'Pushups: 2xMax', 'DB Rows: 2x15', 'Plank: 2x45s'] },
                { key: 'tue', title: 'Active Recovery', exercises: [] },
                { key: 'wed', title: 'Primer Cycle B', exercises: ['Goblet Squats: 2x15', 'Pushups: 2xMax', 'DB Rows: 2x15', 'Plank: 2x45s'] },
                { key: 'thu', title: 'Active Recovery', exercises: [] },
                { key: 'fri', title: 'Primer Cycle C', exercises: ['Goblet Squats: 2x15', 'Pushups: 2xMax', 'DB Rows: 2x15', 'Plank: 2x45s'] },
                { key: 'sat', title: 'Rest Day', exercises: [] },
                { key: 'sun', title: 'Primer Cycle D', exercises: ['Goblet Squats: 2x15', 'Pushups: 2xMax', 'DB Rows: 2x15', 'Plank: 2x45s'] }
            ];

            const dietPlans = {
                veg: { name: "Vegetarian Engine", meals: [ { title: "Breakfast", opt: "Sattu Shake (4 tbsp) + 1 Cup Curd + Banana" }, { title: "Lunch", opt: "Paneer (100g) + 2 Roti + Dal + Salad" }, { title: "Snack", opt: "Roasted Chana + Apple" }, { title: "Pre-Workout", opt: "Peanut Butter Toast" }, { title: "Post-Workout", opt: "Milk or Thick Curd" } ] },
                nonVeg: { name: "Non-Veg Engine", meals: [ { title: "Breakfast", opt: "3 Whole Eggs + 2 Whites + Toast" }, { title: "Lunch", opt: "Chicken (150g) + Brown Rice + Salad" }, { title: "Snack", opt: "Hard Boiled Egg + Apple" }, { title: "Pre-Workout", opt: "PB Toast or Tuna" }, { title: "Post-Workout", opt: "Grilled Fish or Milk" } ] }
            };

            let userProfile = {};
            let weightHistory = [];
            let completedWorkouts = [];
            let waterData = { count: 0, date: "" };
            let goalChart;

            const timeSelect = document.getElementById('profile-workout-time');
            function populateTimes() {
                if (!timeSelect) return;
                timeSelect.innerHTML = '';
                for (let i = 5; i <= 23; i++) {
                    const h = i < 10 ? '0'+i : i;
                    const ampm = i >= 12 ? 'PM' : 'AM';
                    const display = (i > 12 ? i-12 : i) + ':00 ' + ampm;
                    const opt = document.createElement('option');
                    opt.value = h + ':00'; opt.textContent = display;
                    timeSelect.appendChild(opt);
                }
            }

            function applyTheme(theme) {
                document.body.className = theme || 'theme-sunny';
            }

            function navigateTo(id) {
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.toggle('active', b.dataset.target === id));
                document.querySelectorAll('.page-section').forEach(p => p.classList.toggle('active', p.id === id));
                if (id === 'goals-page') updateProgressChart();
                if (id === 'tracker-page') { renderWeightHistory(); renderCalendar(); }
                if (id === 'workout-page') renderWorkoutPlans();
                if (id === 'diet-page') renderDietPlans();
            }

            document.querySelectorAll('.nav-btn').forEach(btn => btn.addEventListener('click', () => navigateTo(btn.dataset.target)));

            function saveToLocal() { localStorage.setItem('transformation_v14_profile', JSON.stringify(userProfile)); }

            function setupSelectors() {
                const groups = [
                    { id: '#theme-choices', key: 'theme' },
                    { id: '#gender-choices', key: 'gender' },
                    { id: '#diet-choices', key: 'diet' },
                    { id: '#equipment-choices', key: 'equipment' },
                    { id: '#deficit-choices', key: 'deficit' },
                    { id: '#unit-choices', key: 'unit' },
                    { id: '#frequency-choices', key: 'frequency' },
                    { id: '#goal-choices', key: 'goal' },
                    { id: '#style-choices', key: 'style' },
                    { id: '#activity-choices', key: 'activity' },
                    { id: '#level-choices', key: 'level' },
                    { id: '#returning-choices', key: 'returning' }
                ];
                groups.forEach(g => {
                    const container = document.querySelector(g.id);
                    if (!container) return;
                    container.querySelectorAll('button').forEach(btn => {
                        btn.addEventListener('click', () => {
                            container.querySelectorAll('button').forEach(b => b.classList.remove('active'));
                            btn.classList.add('active');
                            userProfile[g.key] = btn.dataset[g.key];
                            if(g.key === 'theme') applyTheme(userProfile.theme);
                            if(g.key === 'unit') updateUnitLabels();
                            saveToLocal();
                        });
                    });
                });
            }

            function updateUnitLabels() {
                const isMetric = userProfile.unit === 'metric';
                const hl = document.getElementById('height-label');
                const wl = document.getElementById('weight-label');
                const gl = document.getElementById('goal-weight-label');
                const ul = document.getElementById('weight-unit-label');
                if (hl) hl.textContent = `Height (${isMetric?'cm':'in'})`;
                if (wl) wl.textContent = `Start (${isMetric?'kg':'lb'})`;
                if (gl) gl.textContent = `Goal (${isMetric?'kg':'lb'})`;
                if (ul) ul.textContent = isMetric ? 'kg' : 'lb';
            }

            document.getElementById('save-profile-btn').addEventListener('click', () => {
                userProfile.name = document.getElementById('profile-name').value;
                userProfile.age = document.getElementById('profile-age').value;
                userProfile.height = document.getElementById('profile-height').value;
                userProfile.startWeight = document.getElementById('profile-start-weight').value;
                userProfile.goalWeight = document.getElementById('profile-goal-weight').value;
                userProfile.workoutTime = timeSelect.value;
                userProfile.duration = document.getElementById('profile-duration').value;
                userProfile.stepGoal = document.getElementById('step-goal-input').value;
                userProfile.waterGoal = document.getElementById('water-goal-input').value;

                saveToLocal();
                initApp();
                const msg = document.getElementById('profile-saved-msg');
                if (msg) {
                   msg.classList.remove('hidden');
                   setTimeout(() => msg.classList.add('hidden'), 2000);
                }
            });

            function processExercise(ex) {
                const style = userProfile.style || 'heavy';
                const level = userProfile.level || 'beginner';
                let finalEx = ex;

                if (style !== 'heavy') {
                    const name = ex.split(':')[0].trim();
                    if (heavySwaps[name]) {
                        finalEx = heavySwaps[name] + ": " + (ex.split(':')[1] || '');
                    }
                }

                const parts = finalEx.split(':');
                const baseName = parts[0];
                const sets = level === 'beginner' ? '2x15' : level === 'intermediate' ? '3x10' : '4x12';
                return `${baseName}: ${sets}`;
            }

            function renderDashboardDay(dayKey) {
                const names = { sun:"Sunday", mon:"Monday", tue:"Tuesday", wed:"Wednesday", thu:"Thursday", fri:"Friday", sat:"Saturday" };
                const titleEl = document.getElementById('dashboard-workout-title');
                if (titleEl) titleEl.textContent = "Workout: " + names[dayKey];
                
                const badge = document.getElementById('level-badge');
                if (badge) badge.textContent = (userProfile.level || 'beginner').toUpperCase();

                const isReturning = userProfile.returning === 'yes';
                let workout;

                if (isReturning) {
                    workout = primerCircuit.find(d => d.key === dayKey);
                } else {
                    const equip = userProfile.equipment || 'gym';
                    const goal = userProfile.goal || 'fatLoss';
                    const freq = userProfile.frequency || '3day';
                    const planRoot = workoutMatrix[equip]?.[goal] || workoutMatrix['gym']?.[goal] || workoutMatrix['gym']['fatLoss'];
                    workout = planRoot[freq]?.find(d => d.key === dayKey);
                }

                const container = document.getElementById('dashboard-workout');
                const subtitle = document.getElementById('dashboard-workout-subtitle');
                
                if (workout && workout.exercises && workout.exercises.length > 0) {
                    subtitle.textContent = isReturning ? "Phase: Re-Entry Mode" : "Phase: Blueprint Activated";
                    
                    const hidden = userProfile.hiddenExercises || [];
                    
                    container.innerHTML = workout.exercises.map(ex => {
                        const processed = processExercise(ex);
                        const parts = processed.split(':');
                        const isHidden = hidden.includes(parts[0].trim());
                        
                        if (isHidden) return '';

                        return `<div class="flex justify-between border-b border-gray-50 py-3 exercise-item group">
                                    <div class="flex items-center">
                                        <span class="font-medium text-sm">${parts[0]}</span>
                                        <span class="remove-ex text-xs" onclick="toggleExercise('${parts[0].trim()}')">Hide</span>
                                    </div>
                                    <span class="opacity-60 text-xs font-bold">${parts[1] || ''}</span>
                                </div>`;
                    }).join('');
                    updateCompleteBtn(true);
                } else {
                    subtitle.textContent = "Strategic Rest Day";
                    container.innerHTML = `<p class="italic opacity-50 py-6 text-center text-sm">Rest day. Strategic recovery phase active.</p>`;
                    updateCompleteBtn(false);
                }
                renderSchedule();
            }

            window.toggleExercise = (name) => {
                if (!userProfile.hiddenExercises) userProfile.hiddenExercises = [];
                userProfile.hiddenExercises.push(name);
                saveToLocal();
                const activeBtn = document.querySelector('.day-btn.active');
                if (activeBtn) renderDashboardDay(activeBtn.dataset.day);
            };

            function renderSchedule() {
                const start = userProfile.workoutTime || "20:00";
                const diet = userProfile.diet || 'veg';
                const meals = dietPlans[diet]?.meals || dietPlans.veg.meals;
                const items = [
                    { time: "07:00 AM", text: "Wake up. 1L Hydration." },
                    { time: "07:30 AM", text: `<b>${meals[0].title}</b>: ${meals[0].opt}` },
                    { time: "01:00 PM", text: `<b>${meals[1].title}</b>` },
                    { time: subtractMinutes(start, 90), text: `<b>Pre-Workout Nutrient Fuel</b>` },
                    { time: start, text: "<b>Workout Block</b>" },
                    { time: addMinutesStr(start, 100), text: `<b>Recovery Window Meal</b>` },
                    { time: "11:30 PM", text: "Lights out." }
                ];
                const scheduleEl = document.getElementById('dashboard-schedule');
                if (scheduleEl) {
                    scheduleEl.innerHTML = items.sort((a,b) => compareTime(a.time, b.time)).map(item => `
                        <div class="flex gap-4 p-3 rounded-xl hover:bg-gray-50 transition-colors group">
                            <span class="w-20 text-[10px] font-black opacity-30 uppercase pt-1">${item.time}</span>
                            <span class="flex-1 text-sm">${item.text}</span>
                        </div>
                    `).join('');
                }
            }

            function subtractMinutes(time, mins) {
                const [h, m] = time.split(':').map(Number);
                let date = new Date(); date.setHours(h, (m||0) - mins);
                return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            }
            function addMinutesStr(time, mins) {
                const [h, m] = time.split(':').map(Number);
                let date = new Date(); date.setHours(h, (m||0) + mins);
                return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            }
            function compareTime(a, b) { return new Date("2000/01/01 " + a) - new Date("2000/01/01 " + b); }

            function renderWeightHistory() {
                const unit = userProfile.unit === 'imperial' ? 'lb' : 'kg';
                const table = document.getElementById('weight-history-table');
                if (table) {
                    table.innerHTML = weightHistory.map(w => `
                        <tr><td class="px-6 py-4 text-sm opacity-60">${w.date}</td><td class="px-6 py-4 text-sm font-black">${w.weight} ${unit}</td></tr>
                    `).join('');
                }
            }

            const logWeightBtn = document.getElementById('log-weight-btn');
            if (logWeightBtn) {
                logWeightBtn.addEventListener('click', () => {
                    const val = document.getElementById('weight-input').value;
                    if(!val) return;
                    weightHistory.unshift({ date: new Date().toLocaleDateString(), weight: val });
                    localStorage.setItem('transformation_v14_history', JSON.stringify(weightHistory));
                    renderWeightHistory(); updateHealthMetrics();
                });
            }

            function renderCalendar() {
                const container = document.getElementById('consistency-calendar');
                if (!container) return;
                container.innerHTML = '';
                ['S','M','T','W','T','F','S'].forEach(l => container.innerHTML += `<div class="calendar-day-header text-center text-[10px] font-black opacity-30">${l}</div>`);
                const start = new Date(); start.setDate(start.getDate() - start.getDay());
                for(let i=0; i<28; i++) {
                    const d = new Date(start); d.setDate(d.getDate() + i);
                    const isDone = completedWorkouts.includes(d.toDateString());
                    const isToday = d.toDateString() === new Date().toDateString();
                    container.innerHTML += `<div class="calendar-day ${isDone?'completed':''} ${isToday?'today':''}"><span>${d.getDate()}</span></div>`;
                }
            }

            function updateHealthMetrics() {
                const isMetric = userProfile.unit === 'metric';
                let h = parseFloat(userProfile.height);
                let w = parseFloat(weightHistory[0]?.weight || userProfile.startWeight);
                if (!isMetric) { h *= 2.54; w *= 0.453592; }

                const bmiDisp = document.getElementById('bmi-display');
                if (h && w && bmiDisp) {
                    const bmi = (w / ((h/100) * (h/100))).toFixed(1);
                    bmiDisp.textContent = bmi;
                    let cat = "Normal"; if(bmi<18.5) cat="Under"; if(bmi>25) cat="Over"; if(bmi>30) cat="Obese";
                    const catDisp = document.getElementById('bmi-category');
                    if (catDisp) catDisp.textContent = cat;

                    const age = parseInt(userProfile.age);
                    const gen = userProfile.gender;
                    const act = parseFloat(userProfile.activity) || 1.2;
                    const def = parseInt(userProfile.deficit) || 20;

                    if(age && gen) {
                        let bmr = (10 * w) + (6.25 * h) - (5 * age) + (gen === 'male' ? 5 : -161);
                        let target = (bmr * act) * (1 - (def/100));
                        const bmrDisp = document.getElementById('bmr-display');
                        const tdeeDisp = document.getElementById('tdee-display');
                        if (bmrDisp) bmrDisp.textContent = bmr.toFixed(0);
                        if (tdeeDisp) tdeeDisp.textContent = target.toFixed(0);
                    }
                }
            }

            function updateProgressChart() {
                const canvas = document.getElementById('goal-chart');
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                if(goalChart) goalChart.destroy();
                goalChart = new Chart(ctx, {
                    type: 'line',
                    data: { labels: weightHistory.map(w => w.date).reverse(), datasets: [{ label: 'Weight', data: weightHistory.map(w => w.weight).reverse(), borderColor: '#4f46e5', tension: 0.4 }] },
                    options: { responsive: true, plugins: { legend: { display: false } } }
                });
            }

            function renderDietPlans() {
                const d = userProfile.diet || 'veg';
                const plan = dietPlans[d] || dietPlans.veg;
                const titleEl = document.getElementById('diet-plan-title');
                if (titleEl) titleEl.textContent = (d==='veg'?'Vegetarian':'Non-Veg') + " Engine Blueprint";
                const container = document.getElementById('diet-plan-options-container');
                if (container) {
                    container.innerHTML = plan.meals.map(m => `
                        <div class="card p-6 border-l-4 border-indigo-500">
                            <h3 class="font-black opacity-30 text-[10px] uppercase mb-1">${m.title}</h3>
                            <p class="text-sm font-medium leading-relaxed">${m.opt}</p>
                        </div>
                    `).join('');
                }
            }

            function renderWorkoutPlans() {
                const age = parseInt(userProfile.age);
                if (age) {
                    const guideCard = document.getElementById('guidance-card');
                    if (guideCard) guideCard.classList.remove('hidden');
                    const gTitle = document.getElementById('guidance-title');
                    const gContent = document.getElementById('guidance-content');
                    if (gTitle) gTitle.textContent = `Advisory: Age ${age} (${userProfile.level})`;
                    if (gContent) gContent.textContent = age > 40 ? "Focus on joint integrity and higher reps." : "Peak systemic capacity. Emphasize intensity.";
                }

                const goal = userProfile.goal || 'fatLoss';
                const freq = userProfile.frequency || '3day';
                const equip = userProfile.equipment || 'gym';
                const planRoot = workoutMatrix[equip]?.[goal] || workoutMatrix['gym']?.[goal] || workoutMatrix['gym']['fatLoss'];
                const plan = planRoot[freq] || planRoot['3day'];

                const container = document.getElementById('workout-plan-container');
                if (container) {
                    container.innerHTML = plan.map(d => `
                        <div class="p-6 border border-gray-100 bg-gray-50 rounded-2xl">
                            <h4 class="font-bold mb-3">${d.title}</h4>
                            <ul class="space-y-2">
                                ${d.exercises.map(ex => {
                                    const processed = processExercise(ex);
                                    return `<li class="flex justify-between text-sm border-b border-white pb-1"><span>${processed.split(':')[0]}</span><span class="font-bold">${processed.split(':')[1]||''}</span></li>`;
                                }).join('')}
                            </ul>
                        </div>
                    `).join('');
                }
            }

            function updateCompleteBtn(active) {
                const container = document.getElementById('workout-complete-container');
                if (!container) return;
                const today = new Date().toDateString();
                if(!active) { container.innerHTML = ""; return; }
                if(completedWorkouts.includes(today)) {
                    container.innerHTML = `<div class="bg-green-100 text-green-700 p-4 rounded-xl text-center font-bold text-sm">Session Logged</div>`;
                } else {
                    container.innerHTML = `<button id="finish-btn" class="btn-primary bg-indigo-600">Sync Session Finish</button>`;
                    const btn = document.getElementById('finish-btn');
                    if (btn) {
                        btn.addEventListener('click', () => {
                            completedWorkouts.push(today);
                            localStorage.setItem('transformation_v14_workouts', JSON.stringify(completedWorkouts));
                            updateCompleteBtn(true); renderCalendar();
                        });
                    }
                }
            }

            function initApp() {
                userProfile = JSON.parse(localStorage.getItem('transformation_v14_profile')) || {};
                weightHistory = JSON.parse(localStorage.getItem('transformation_v14_history')) || [];
                completedWorkouts = JSON.parse(localStorage.getItem('transformation_v14_workouts')) || [];
                waterData = JSON.parse(localStorage.getItem('transformation_v14_water')) || { count: 0, date: new Date().toDateString() };
                if(waterData.date !== new Date().toDateString()) waterData = { count: 0, date: new Date().toDateString() };

                applyTheme(userProfile.theme);
                updateUnitLabels();
                
                const dateDisp = document.getElementById('current-date-display');
                if (dateDisp) dateDisp.textContent = new Date().toLocaleDateString(undefined, { weekday:'long', month:'short', day:'numeric' });
                
                const nI = document.getElementById('profile-name'); if(nI) nI.value = userProfile.name || '';
                const aI = document.getElementById('profile-age'); if(aI) aI.value = userProfile.age || '';
                const hI = document.getElementById('profile-height'); if(hI) hI.value = userProfile.height || '';
                const swI = document.getElementById('profile-start-weight'); if(swI) swI.value = userProfile.startWeight || '';
                const gwI = document.getElementById('profile-goal-weight'); if(gwI) gwI.value = userProfile.goalWeight || '';
                
                const waterGoalDisp = document.getElementById('water-goal-display'); if(waterGoalDisp) waterGoalDisp.textContent = userProfile.waterGoal || '16';
                const waterGoalInp = document.getElementById('water-goal-input'); if(waterGoalInp) waterGoalInp.value = userProfile.waterGoal || '16';
                const stepGoalInp = document.getElementById('step-goal-input'); if(stepGoalInp) stepGoalInp.value = userProfile.stepGoal || '10000';
                
                const stepGoalDisp = document.getElementById('step-goal-display');
                if (stepGoalDisp) stepGoalDisp.textContent = "/ " + (userProfile.stepGoal ? (parseInt(userProfile.stepGoal)/1000).toFixed(0) : "10") + "k";
                
                const durI = document.getElementById('profile-duration'); if(durI) durI.value = userProfile.duration || '8';
                
                populateTimes();
                if (timeSelect) timeSelect.value = userProfile.workoutTime || "20:00";

                const setAct = (sel, val) => {
                    const container = document.querySelector(sel);
                    if (container) {
                        container.querySelectorAll('button').forEach(b => {
                            const btnVal = b.dataset[Object.keys(b.dataset)[0]];
                            b.classList.toggle('active', btnVal === val);
                        });
                    }
                };
                ['#theme-choices', '#gender-choices', '#diet-choices', '#equipment-choices', '#deficit-choices', '#unit-choices', '#frequency-choices', '#goal-choices', '#style-choices', '#activity-choices', '#level-choices', '#returning-choices'].forEach(s => setAct(s, userProfile[s.replace('#','').replace('-choices','')]));

                const dashTitle = document.getElementById('dashboard-title');
                if (dashTitle) dashTitle.textContent = userProfile.name ? `Execute, ${userProfile.name}!` : "Welcome!";
                
                const waterCnt = document.getElementById('water-count');
                if (waterCnt) waterCnt.textContent = waterData.count;
                
                const todayKey = ['sun','mon','tue','wed','thu','fri','sat'][new Date().getDay()];
                const dayBtn = document.querySelector(`.day-btn[data-day="${todayKey}"]`);
                if (dayBtn) dayBtn.click();
                updateHealthMetrics();

                if(!userProfile.name) {
                    const setup = document.getElementById('setup-modal');
                    if (setup) setup.classList.remove('hidden');
                }
            }

            const resetBtn = document.getElementById('reset-app-btn');
            if (resetBtn) resetBtn.addEventListener('click', () => { if(confirm("Clear system memory?")) { localStorage.clear(); window.location.reload(); } });
            
            const setupModalBtn = document.getElementById('go-to-profile-btn-modal');
            if (setupModalBtn) setupModalBtn.addEventListener('click', () => { document.getElementById('setup-modal').classList.add('hidden'); navigateTo('profile-page'); });
            
            const waterPlus = document.getElementById('water-plus-btn');
            if (waterPlus) waterPlus.addEventListener('click', () => { waterData.count++; document.getElementById('water-count').textContent = waterData.count; localStorage.setItem('transformation_v14_water', JSON.stringify(waterData)); });
            
            const waterMinus = document.getElementById('water-minus-btn');
            if (waterMinus) waterMinus.addEventListener('click', () => { if(waterData.count > 0) waterData.count--; document.getElementById('water-count').textContent = waterData.count; localStorage.setItem('transformation_v14_water', JSON.stringify(waterData)); });

            setupSelectors();
            initApp();
        });
    </script>
</body>
</html>
